%% Different noise bounds
close all
D = 21; %data length

%Fix certain parameters for projection
a11_plot = 1;
a12_plot = 0.5;
b1_plot = 0;
b2_plot = T;
a21_plot = -0.55:0.00005:-0.48;
a22_plot = 0.45:0.0005:0.7;


figure
xlabel('a21')
ylabel('a22')
hold on
epsilon = 0.05;
x_sample = [0,-0.0313785862531084,0.230479244756359,0.620852376486810,1.04055923763207,1.31894583545300,1.43995411646121,1.41102483055342,1.27445262484445,1.10917762775951,0.927761422384806,0.793049598350027,0.723618549742948,0.685089830719791,0.700419196554169,0.704818582319741,0.713128127103381,0.686196018133750,0.686692435622522,0.637644036004096,0.617581022529371,0.577876996803336;0,0.535720912789072,0.747309757524982,0.766901851953914,0.547025675207615,0.247888567475649,-0.0517938552117472,-0.265281922249159,-0.361276612277341,-0.362507623923263,-0.270533609853343,-0.160174273380917,-0.0751527303465063,0.0179547361246711,0.0681238221028477,0.0770429306236666,0.0214063421130552,0.0334174547295289,-0.0198881809596860,-0.0733904836366641,-0.0425535618411639,-0.0779350236657734];
u_sample = [1,0.998750260394966,0.995004165278026,0.988771077936042,0.980066577841242,0.968912421710645,0.955336489125606,0.939372712847379,0.921060994002885,0.900447102352677,0.877582561890373,0.852524522059506,0.825335614909678,0.796083798549056,0.764842187284488,0.731688868873821,0.696706709347165,0.659983145884982,0.621609968270664,0.581683089463884,0.540302305868140];
set_mem = []; %collect coefficients within set membership
for i = a21_plot
for j = a22_plot
constr_violation = 0;    
for S = 1:D
    if((x_sample(:,S+1)-[a11_plot a12_plot b1_plot; i j b2_plot]*[x_sample(:,S); u_sample(S)])'*(x_sample(:,S+1)-[a11_plot a12_plot b1_plot; i j b2_plot]*[x_sample(:,S); u_sample(S)]) > epsilon^2) %check whether coefficients explain all samples
        constr_violation = 1; 
        S = D;
    end 
end
    if(constr_violation==0)    
        set_mem = [set_mem [i;j]];
    end 
end
end
scatter(set_mem(1,:),set_mem(2,:),'square','filled') %plot set membership

%repeat for different data sets
a21_plot = -0.51:0.00005:-0.48;
a22_plot = 0.45:0.0005:0.55;


epsilon = 0.01;
x_sample = [0,-0.000354869499418552,0.251717114683490,0.614289800324041,0.990491961858912,1.26846675237783,1.40979499165431,1.40077533441195,1.27635145333768,1.10900924957040,0.930875102321607,0.801522068571899,0.721597299933832,0.685655434982603,0.695142201443788,0.726781746872798,0.759580157088230,0.786772436734648,0.785958840943529,0.757904349709403,0.688029284012623,0.622654481002567;0,0.500166162684637,0.740383761934217,0.741318147041810,0.558608384350199,0.272821652120425,-0.0141501437759872,-0.229504844600700,-0.343148347733938,-0.341791916133931,-0.268834260066713,-0.165585680447835,-0.0601298351865956,0.0145323708837630,0.0667300216683242,0.0697627454187967,0.0407062633222617,-0.0127980832203080,-0.0698338680198165,-0.120278199633063,-0.146173863331613,-0.152708067167646];
u_sample = [1,0.998750260394966,0.995004165278026,0.988771077936042,0.980066577841242,0.968912421710645,0.955336489125606,0.939372712847379,0.921060994002885,0.900447102352677,0.877582561890373,0.852524522059506,0.825335614909678,0.796083798549056,0.764842187284488,0.731688868873821,0.696706709347165,0.659983145884982,0.621609968270664,0.581683089463884,0.540302305868140];
set_mem = [];
for i = a21_plot
for j = a22_plot
constr_violation = 0;    
for S = 1:D
    if((x_sample(:,S+1)-[a11_plot a12_plot b1_plot; i j b2_plot]*[x_sample(:,S); u_sample(S)])'*(x_sample(:,S+1)-[a11_plot a12_plot b1_plot; i j b2_plot]*[x_sample(:,S); u_sample(S)]) > epsilon^2)
        constr_violation = 1; 
        S = D;
    end 
end
    if(constr_violation==0)    
        set_mem = [set_mem [i;j]];
    end 
end
end
scatter(set_mem(1,:),set_mem(2,:),'square','filled')


epsilon = 0.002;
x_sample = [0,-0.000500028161871412,0.250884415292693,0.624450770782931,0.997145556681367,1.27435104913363,1.40972198326193,1.39978607260797,1.28207433935015,1.11015081109994,0.931886694071818,0.790850860906897,0.707153113826612,0.681474275335179,0.698357080672337,0.735382096648103,0.771959957790450,0.790156796235955,0.780310833726943,0.741702123444500,0.683705303661813,0.614720081933256;0,0.500111088780521,0.748506802505912,0.746884671173728,0.554151796138173,0.268388468811564,-0.0197784672680105,-0.237052405304027,-0.347129583190647,-0.354810240454568,-0.281656247596850,-0.167859158858282,-0.0533623721425800,0.0314152523928918,0.0741886488991432,0.0703439428586236,0.0327590076868541,-0.0206458302409228,-0.0749170365648399,-0.117362556008336,-0.138736934903766,-0.140868565809958];
u_sample = [1,0.998750260394966,0.995004165278026,0.988771077936042,0.980066577841242,0.968912421710645,0.955336489125606,0.939372712847379,0.921060994002885,0.900447102352677,0.877582561890373,0.852524522059506,0.825335614909678,0.796083798549056,0.764842187284488,0.731688868873821,0.696706709347165,0.659983145884982,0.621609968270664,0.581683089463884,0.540302305868140];
set_mem = [];
for i = a21_plot
for j = a22_plot
constr_violation = 0;    
for S = 1:D
    if((x_sample(:,S+1)-[a11_plot a12_plot b1_plot; i j b2_plot]*[x_sample(:,S); u_sample(S)])'*(x_sample(:,S+1)-[a11_plot a12_plot b1_plot; i j b2_plot]*[x_sample(:,S); u_sample(S)]) > epsilon^2)
        constr_violation = 1; 
        S = D;
    end 
end
    if(constr_violation==0)    
        set_mem = [set_mem [i;j]];
    end 
end
end
scatter(set_mem(1,:),set_mem(2,:),'square','filled')

%% Different data length
epsilon = 0.005; %noise bound

%Fix certain parameters for projection
a21_plot = -0.51:0.00002:-0.49;
a22_plot = 0.49:0.0002:0.51;
a11_plot = 1;
a12_plot = 0.5;
b1_plot = 0;
b2_plot = T;


figure
xlabel('a21')
ylabel('a22')
hold on
x_sample = [0,0.00367330293854449,0.249663696869468,0.624648685717320,0.999250715326783,1.27658498347765,1.41106767230117,1.40109074200217,1.28163757545397,1.10540009470982,0.923368364958011,0.779481760777544,0.696077268711479,0.672596632427268,0.692531544222670,0.733505013957798,0.773897479754580,0.793224483736998,0.783182795762950,0.748603039073851,0.686522890126383,0.618371993607847;0,0.496956211456017,0.744931484502956,0.746108732509643,0.555271985946360,0.268233189223301,-0.0205526912471172,-0.238497639300784,-0.352416253473753,-0.356460144376312,-0.283251997652213,-0.166803104162662,-0.0468737139141745,0.0410468342182852,0.0831273241472819,0.0799159196143175,0.0385849995088900,-0.0192768274199255,-0.0726461214504493,-0.117419075546849,-0.140203202027438,-0.142231343531869];
u_sample = [1,0.998750260394966,0.995004165278026,0.988771077936042,0.980066577841242,0.968912421710645,0.955336489125606,0.939372712847379,0.921060994002885,0.900447102352677,0.877582561890373,0.852524522059506,0.825335614909678,0.796083798549056,0.764842187284488,0.731688868873821,0.696706709347165,0.659983145884982,0.621609968270664,0.581683089463884,0.540302305868140];
u_sample = u_sample(1:5); %reduce data length
x_sample = x_sample(:,1:6);
D = 5;
set_mem = [];
for i = a21_plot
for j = a22_plot
constr_violation = 0;    
for S = 1:D
    if((x_sample(:,S+1)-[a11_plot a12_plot b1_plot; i j b2_plot]*[x_sample(:,S); u_sample(S)])'*(x_sample(:,S+1)-[a11_plot a12_plot b1_plot; i j b2_plot]*[x_sample(:,S); u_sample(S)]) > epsilon^2) %check whether coefficients explain all samples
        constr_violation = 1; 
        S = D;
    end 
end
    if(constr_violation==0)    
        set_mem = [set_mem [i;j]];
    end 
end
end
scatter(set_mem(1,:),set_mem(2,:),'square','filled') %plot set membership

%repeat for different data sets
x_sample = [0,0.00367330293854449,0.249663696869468,0.624648685717320,0.999250715326783,1.27658498347765,1.41106767230117,1.40109074200217,1.28163757545397,1.10540009470982,0.923368364958011,0.779481760777544,0.696077268711479,0.672596632427268,0.692531544222670,0.733505013957798,0.773897479754580,0.793224483736998,0.783182795762950,0.748603039073851,0.686522890126383,0.618371993607847;0,0.496956211456017,0.744931484502956,0.746108732509643,0.555271985946360,0.268233189223301,-0.0205526912471172,-0.238497639300784,-0.352416253473753,-0.356460144376312,-0.283251997652213,-0.166803104162662,-0.0468737139141745,0.0410468342182852,0.0831273241472819,0.0799159196143175,0.0385849995088900,-0.0192768274199255,-0.0726461214504493,-0.117419075546849,-0.140203202027438,-0.142231343531869];
u_sample = [1,0.998750260394966,0.995004165278026,0.988771077936042,0.980066577841242,0.968912421710645,0.955336489125606,0.939372712847379,0.921060994002885,0.900447102352677,0.877582561890373,0.852524522059506,0.825335614909678,0.796083798549056,0.764842187284488,0.731688868873821,0.696706709347165,0.659983145884982,0.621609968270664,0.581683089463884,0.540302305868140];
u_sample = u_sample(1:7);
x_sample = x_sample(:,1:8);
D = 7;
set_mem = [];
for i = a21_plot
for j = a22_plot
constr_violation = 0;    
for S = 1:D
    if((x_sample(:,S+1)-[a11_plot a12_plot b1_plot; i j b2_plot]*[x_sample(:,S); u_sample(S)])'*(x_sample(:,S+1)-[a11_plot a12_plot b1_plot; i j b2_plot]*[x_sample(:,S); u_sample(S)]) > epsilon^2)
        constr_violation = 1; 
        S = D;
    end 
end
    if(constr_violation==0)    
        set_mem = [set_mem [i;j]];
    end 
end
end
scatter(set_mem(1,:),set_mem(2,:),'square','filled')



x_sample = [0,0.00367330293854449,0.249663696869468,0.624648685717320,0.999250715326783,1.27658498347765,1.41106767230117,1.40109074200217,1.28163757545397,1.10540009470982,0.923368364958011,0.779481760777544,0.696077268711479,0.672596632427268,0.692531544222670,0.733505013957798,0.773897479754580,0.793224483736998,0.783182795762950,0.748603039073851,0.686522890126383,0.618371993607847;0,0.496956211456017,0.744931484502956,0.746108732509643,0.555271985946360,0.268233189223301,-0.0205526912471172,-0.238497639300784,-0.352416253473753,-0.356460144376312,-0.283251997652213,-0.166803104162662,-0.0468737139141745,0.0410468342182852,0.0831273241472819,0.0799159196143175,0.0385849995088900,-0.0192768274199255,-0.0726461214504493,-0.117419075546849,-0.140203202027438,-0.142231343531869];
u_sample = [1,0.998750260394966,0.995004165278026,0.988771077936042,0.980066577841242,0.968912421710645,0.955336489125606,0.939372712847379,0.921060994002885,0.900447102352677,0.877582561890373,0.852524522059506,0.825335614909678,0.796083798549056,0.764842187284488,0.731688868873821,0.696706709347165,0.659983145884982,0.621609968270664,0.581683089463884,0.540302305868140];
D = 21;
set_mem = [];
for i = a21_plot
for j = a22_plot
constr_violation = 0;    
for S = 1:D
    if((x_sample(:,S+1)-[a11_plot a12_plot b1_plot; i j b2_plot]*[x_sample(:,S); u_sample(S)])'*(x_sample(:,S+1)-[a11_plot a12_plot b1_plot; i j b2_plot]*[x_sample(:,S); u_sample(S)]) > epsilon^2)
        constr_violation = 1; 
        S = D;
    end 
end
    if(constr_violation==0)    
        set_mem = [set_mem [i;j]];
    end 
end
end
scatter(set_mem(1,:),set_mem(2,:),'square','filled')

